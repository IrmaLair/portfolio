<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Projects — Nidhi Surekha</title>
  <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body class="projects-page">
  <!-- Splash overlay (shows before JS hydrates) -->
  <div class="splash-overlay" id="splash-overlay">
    <div class="splash-inner"><img class="splash-logo" src="assets/Logo.svg" alt="logo"></div>
  </div>
  <!-- sand texture background (shared with homepage) -->
  <div class="sand-overlay" aria-hidden="true"></div>
  <main class="container" style="padding:3rem 2rem;">
    <a href="index.html" class="page-logo" aria-label="Home">
      <img src="assets/Logo.svg" alt="Home" width="48" height="48">
    </a>
  <!-- background audio removed (shared bg audio lives on homepage) -->
  <h1 class="handwriting" style="text-align:center;">Projects</h1>

    <section id="projects-app" style="margin-top:1.5rem;">
      <div class="chips-row">
        <div id="category-chips" aria-label="Project categories"></div>
      </div>

      <div id="category-grid" class="projects-grid" aria-live="polite"></div>
    </section>

    <!-- Load data first, then main (which contains shared utilities), then run the renderer -->
    <script src="scripts/projects-data.js"></script>
    <script src="scripts/main.js"></script>
    <script>
      // Renderer that consumes window.PROJECTS_DATA
      (function(){
        const PROJECTS = window.PROJECTS_DATA || [];

        function slugify(name){ return String(name||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }

        function createCard(p){
          const a = document.createElement('a'); a.className='card-link'; a.setAttribute('role','link'); a.setAttribute('aria-label', p['Project Name']); a.setAttribute('tabindex','0');
          const slug = (p.slug && String(p.slug).trim()) ? String(p.slug).trim() : (slugify(p['Project Name']) + '-' + (p.row||''));
          a.href = 'projects/' + slug + '.html';
          const article = document.createElement('article'); article.className='card';
          const img = document.createElement('img'); img.src='assets/project1.svg'; img.alt=p['Project Name'];
          const body = document.createElement('div'); body.className='card-body';
          const h3 = document.createElement('h3'); h3.textContent = p['Project Name'];
          const tagsRaw = p['Tags'] || '';
          const tagList = String(tagsRaw).split(/\n|,/).map(t=>t.trim()).filter(Boolean);
          const tagsWrap = document.createElement('div'); tagsWrap.className='tag-list';
          tagList.forEach(t=>{ const s = document.createElement('span'); s.className='tag-pill'; s.textContent = t; tagsWrap.appendChild(s); });
          const duration = (p['Duration'] && String(p['Duration']).trim() && String(p['Duration']).trim() !== '-') ? String(p['Duration']).trim() : (p['Time']||'');
          const metaLine = document.createElement('div'); metaLine.className='project-meta'; metaLine.textContent = duration ? ('Individual · ' + duration) : 'Individual';
          body.appendChild(h3); if(tagList.length>0) body.appendChild(tagsWrap); body.appendChild(metaLine);
          article.appendChild(img); article.appendChild(body); a.appendChild(article); return a;
        }

        function adjustTagOverflow(container){
          const tagsWrap = container.querySelector('.tag-list'); if(!tagsWrap) return;
          const pills = Array.from(tagsWrap.querySelectorAll('.tag-pill'));
          if(pills.length <= 4) return;
          const extra = pills.length - 4;
          for(let i=pills.length-1;i>=4;i--) pills[i].remove();
          const plus = document.createElement('button'); plus.className='tag-pill tag-plus'; plus.type='button'; plus.textContent = '+' + extra;
          plus.addEventListener('click', ()=>{
            // show a simple alert-style overlay listing tags (accessible fallback)
            const list = pills.map(p=>p.textContent).join(', ');
            alert(list);
          });
          tagsWrap.appendChild(plus);
        }

        function clearActiveChips(){ Array.from(chipsBar.querySelectorAll('.chip')).forEach(c=>c.classList.remove('chip--active')); }
        function setCategoryInURL(name){ try{ const url = new URL(window.location.href); url.searchParams.set('category', name); window.history.replaceState(null,'', url.toString()); } catch(e){} }
        function getCategoryFromURL(){ const params = new URLSearchParams(window.location.search); return params.get('category'); }

        function renderChip(name){
          const btn = document.createElement('button');
          btn.className='chip';
          btn.type='button';
          btn.textContent = name;
          btn.setAttribute('aria-pressed','false');
          btn.addEventListener('click', ()=>{
            clearActiveChips(); btn.classList.add('chip--active'); btn.setAttribute('aria-pressed','true');
            // render projects for this category
            categoryGrid.innerHTML='';
            // update URL so the current category is shareable
            setCategoryInURL(name);
            if(name === 'Featured'){
              const list = PROJECTS.filter(x=> (String(x.Featured||'').toLowerCase().trim()) === 'yes');
              if(list.length===0){ categoryGrid.innerHTML='<div style="color:#777">No featured projects yet.</div>'; return; }
              list.forEach(p=>{ const card = createCard(p); categoryGrid.appendChild(card); });
              requestAnimationFrame(()=>{ Array.from(categoryGrid.querySelectorAll('.card-link')).forEach(card=> adjustTagOverflow(card)); });
              return;
            }
            const list = PROJECTS.filter(x=> String(x.Category||'').trim() === name);
            if(list.length===0){ categoryGrid.innerHTML='<div style="color:#777">No projects in this category yet.</div>'; return; }
            list.forEach(p=>{ const card = createCard(p); categoryGrid.appendChild(card); });
            requestAnimationFrame(()=>{ Array.from(categoryGrid.querySelectorAll('.card-link')).forEach(card=> adjustTagOverflow(card)); });
          });
          return btn;
        }

        // bootstrap: build category chips and render initial selection
        const chipsBar = document.getElementById('category-chips');
        const categoryGrid = document.getElementById('category-grid');

        // compute categories with Featured first
        const categories = Array.from(new Set(PROJECTS.map(p=> (p.Category||'').trim()).filter(Boolean)) ).sort();
        categories.unshift('Featured');

        categories.forEach(cat => { chipsBar.appendChild(renderChip(cat)); });

        // activate category from URL or default to first
        const initial = getCategoryFromURL() || 'Featured';
        const initialBtn = Array.from(chipsBar.children).find(b => b.textContent === initial) || chipsBar.firstElementChild;
        if(initialBtn){ initialBtn.click(); }

      })();
    </script>
  </main>
</body>
</html>